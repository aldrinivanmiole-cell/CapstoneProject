{% extends 'admin_base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Admin Dashboard</h3>
</div>

<div class="row g-3 mb-4">
  <div class="col-sm-6 col-lg-3"><div class="card p-3"><div>Teachers</div><div class="h4">{{ teacher_count }}</div></div></div>
  <div class="col-sm-6 col-lg-3"><div class="card p-3"><div>Students</div><div class="h4">{{ student_count }}</div></div></div>
  <div class="col-sm-6 col-lg-3"><div class="card p-3"><div>Classes</div><div class="h4">{{ class_count }}</div></div></div>
  <div class="col-sm-6 col-lg-3"><div class="card p-3"><div>Enrollments</div><div class="h4">{{ enrollment_count }}</div></div></div>
</div>

<div class="card p-3">
  <div class="d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center gap-2">
      <h5 class="mb-0">Management</h5>
      <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('admin_teachers') }}">Teachers</a>
      <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('admin_students') }}">Students</a>
      <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('admin_classes') }}">Classes</a>
      <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('admin_enrollments') }}">Enrollments</a>
    </div>
  </div>
  
  <hr class="my-3">
  <h6 class="mb-3">Recent Classes</h6>
  <div class="list-group mt-3">
    {% for c in classes %}
    <div class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <div class="fw-bold">{{ c.name }}{% if c.section %} - {{ c.section %}{% endif %}</div>
        <div class="text-muted small">Code: {{ c.class_code }} â€¢ Teacher: {{ c.teacher.full_name if c.teacher else 'No Teacher' }}</div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
  <div class="row g-4 mb-4">
    <div class="col-sm-6 col-lg-3">
      <div class="card text-center h-100">
        <div class="card-body">
          <i class="bi bi-person-badge h1 text-primary"></i>
          <h5 class="card-title">Teachers</h5>
          <h3 class="text-primary">{{ teacher_count }}</h3>
          <a href="{{ url_for('admin_teachers') }}" class="btn btn-sm btn-outline-primary">Manage</a>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-lg-3">
      <div class="card text-center h-100">
        <div class="card-body">
          <i class="bi bi-people h1 text-success"></i>
          <h5 class="card-title">Students</h5>
          <h3 class="text-success">{{ student_count }}</h3>
          <a href="{{ url_for('admin_students') }}" class="btn btn-sm btn-outline-success">Manage</a>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-lg-3">
      <div class="card text-center h-100">
        <div class="card-body">
          <i class="bi bi-book h1 text-info"></i>
          <h5 class="card-title">Classes</h5>
          <h3 class="text-info">{{ class_count }}</h3>
          <a href="{{ url_for('admin_classes') }}" class="btn btn-sm btn-outline-info">Manage</a>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-lg-3">
      <div class="card text-center h-100">
        <div class="card-body">
          <i class="bi bi-archive h1 text-warning"></i>
          <h5 class="card-title">Archived</h5>
          <h3 class="text-warning">{{ archived_count }}</h3>
          <a href="{{ url_for('archived_classes') }}" class="btn btn-sm btn-outline-warning">View</a>
        </div>
      </div>
    </div>
  </div>
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0"><i class="bi bi-list-ul"></i> Recent Classes</h5>
      <div>
        <a href="{{ url_for('admin_enrollments') }}" class="btn btn-sm btn-primary">
          <i class="bi bi-person-plus"></i> Manage Enrollments
        </a>
        <a href="{{ url_for('admin_classes') }}" class="btn btn-sm btn-outline-primary">View All Classes</a>
      </div>
    </div>
    <div class="card-body">
      {% if classes %}
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Class Name</th>
              <th>Code</th>
              <th>Teacher</th>
              <th>Status</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for c in classes %}
            <tr>
              <td>
                <strong>{{ c.name }}</strong>
                {% if c.section %}<br><small class="text-muted">{{ c.section }}</small>{% endif %}
              </td>
              <td><code>{{ c.class_code }}</code></td>
              <td>{{ c.teacher.full_name if c.teacher else 'No Teacher' }}</td>
              <td>
                {% if c.is_archived %}
                <span class="badge bg-warning">Archived</span>
                {% else %}
                <span class="badge bg-success">Active</span>
                {% endif %}
              </td>
              <td class="text-end">
                <div class="btn-group btn-group-sm">
                  {% if not c.is_archived %}
                  <form method="post" action="{{ url_for('archive_class', class_id=c.id) }}" style="display: inline;">
                    <button class="btn btn-outline-warning" type="submit" onclick="return confirm('Archive this class?')">
                      <i class="bi bi-archive"></i>
                    </button>
                  </form>
                  {% else %}
                  <form method="post" action="{{ url_for('restore_class', class_id=c.id) }}" style="display: inline;">
                    <button class="btn btn-outline-success" type="submit">
                      <i class="bi bi-arrow-repeat"></i>
                    </button>
                  </form>
                  {% endif %}
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="text-center py-4 text-muted">
        <i class="bi bi-book h1"></i>
        <p>No classes found. <a href="{{ url_for('admin_classes') }}">Create your first class</a></p>
      </div>
      {% endif %}
    </div>
{% endblock %}
